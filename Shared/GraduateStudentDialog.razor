@inject ISnackbar Snackbar
@inject IJSRuntime JS

<MudDialog Style="max-width: 500px;">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.School" Class="mr-2" Style="vertical-align: middle;" />
            Öğrenci Mezun Et
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudAlert Severity="Severity.Info" Class="mb-4">
            <MudIcon Icon="@Icons.Material.Filled.Info" Class="mr-1" />
            Öğrenci mezun edildiğinde aktif burs durumu otomatik olarak sonlandırılacaktır.
        </MudAlert>

        <MudPaper Elevation="0" Class="pa-3 mb-3" Style="background-color: #f8fafc; border-radius: 8px; border-left: 4px solid #667eea;">
            <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="mb-3">
                <MudIcon Icon="@Icons.Material.Filled.CalendarToday" Size="Size.Small" Class="mr-1" />
                Mezuniyet Bilgisi
            </MudText>
            <div class="form-group">
                <label class="form-label">Mezuniyet Tarihi *</label>
                <InputDate @bind-Value="_mezuniyetTarihiDate" class="form-control" />
            </div>
        </MudPaper>
        
        <MudPaper Elevation="0" Class="pa-3" Style="background-color: #d1fae5; border-radius: 12px; border-left: 4px solid #22c55e;">
            <MudText Typo="Typo.subtitle2" Color="Color.Success" Class="mb-3">
                <MudIcon Icon="@Icons.Material.Filled.Work" Size="Size.Small" Class="mr-1" />
                Kariyer Bilgisi (Opsiyonel)
            </MudText>
            <MudGrid Spacing="2">
                <MudItem xs="12">
                    <MudTextField @bind-Value="_meslek" 
                                 Label="Meslek" 
                                 Placeholder="Örn: Yazılım Geliştirici, Doktor, Öğretmen"
                                 Variant="Variant.Outlined" 
                                 Margin="Margin.Dense" />
                </MudItem>
                <MudItem xs="12">
                    <MudTextField @bind-Value="_firma" 
                                 Label="Çalıştığı Firma" 
                                 Placeholder="Örn: ABC Yazılım A.Ş., XYZ Hastanesi"
                                 Variant="Variant.Outlined" 
                                 Margin="Margin.Dense" />
                </MudItem>
            </MudGrid>
        </MudPaper>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Variant="Variant.Text">İptal</MudButton>
        <MudButton Color="Color.Success" Variant="Variant.Filled" OnClick="Graduate" StartIcon="@Icons.Material.Filled.School">
            Mezun Et
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = null!;

    private DateTime? _mezuniyetTarihiDate = DateTime.Now;
    private string _meslek = string.Empty;
    private string _firma = string.Empty;

    private async Task Graduate()
    {
        if (!_mezuniyetTarihiDate.HasValue)
        {
            Snackbar.Add("Lütfen mezuniyet tarihi seçiniz", Severity.Warning);
            return;
        }

        var result = new GraduationResult
        {
            MezuniyetTarihi = _mezuniyetTarihiDate.Value,
            Meslek = string.IsNullOrWhiteSpace(_meslek) ? null : _meslek,
            Firma = string.IsNullOrWhiteSpace(_firma) ? null : _firma
        };

        MudDialog.Close(DialogResult.Ok(result));
    }

    private void Cancel() => MudDialog.Cancel();

    public class GraduationResult
    {
        public DateTime MezuniyetTarihi { get; set; }
        public string? Meslek { get; set; }
        public string? Firma { get; set; }
    }
}
