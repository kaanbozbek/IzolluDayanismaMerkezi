@inherits LayoutComponentBase
@inject AuthService AuthService
@inject NavigationManager Navigation

<MudThemeProvider Theme="_theme" />
<MudDialogProvider />
<MudSnackbarProvider />

@if (AuthService.IsAuthenticated)
{
    <MudLayout>
        <MudDrawer Open="true" 
                   ClipMode="DrawerClipMode.Always" 
                   Elevation="2"
                   Variant="@DrawerVariant.Persistent">
            <NavMenu OnLogout="@EventCallback.Factory.Create(this, HandleLogout)" />
        </MudDrawer>
        <MudMainContent>
            <MudContainer MaxWidth="MaxWidth.False" Class="mt-4">
                @Body
            </MudContainer>
        </MudMainContent>
    </MudLayout>
}
else
{
    @Body
}

@code {
    protected override void OnInitialized()
    {
        // Eğer login sayfasında değilse ve giriş yapmamışsa login'e yönlendir
        var currentPath = Navigation.ToBaseRelativePath(Navigation.Uri);
        if (!currentPath.StartsWith("login") && !AuthService.IsAuthenticated)
        {
            Navigation.NavigateTo("/login", true);
        }
    }

    private void HandleLogout()
    {
        AuthService.Logout();
        Navigation.NavigateTo("/login", forceLoad: true);
    }

    private MudTheme _theme = new MudTheme()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#f07d00",
            PrimaryDarken = "#d46d00",
            PrimaryLighten = "#ff9933",
            Secondary = "#1E88E5",
            AppbarBackground = "#f07d00",
        },
        PaletteDark = new PaletteDark()
        {
            Primary = "#f07d00",
            PrimaryDarken = "#d46d00",
            PrimaryLighten = "#ff9933",
        }
    };
}
